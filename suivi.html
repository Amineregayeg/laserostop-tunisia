<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi des S√©ances - LaserOstop Tunisie</title>
    <link rel="stylesheet" href="styles.css?v=11">
    <link rel="manifest" href="pwa/manifest.webmanifest">
    <meta name="theme-color" content="#0C9AA6">
    <meta name="description" content="Suivi et confirmation des s√©ances LaserOstop Tunisie">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="assets/logo.webp" alt="LaserOstop Tunisie" class="logo-img">
                <select id="centerSelect" class="center-select">
                    <option value="tunis">Tunis</option>
                    <option value="sfax">Sfax</option>
                </select>
            </div>
            <nav class="nav-controls">
                <a href="index.html" class="btn btn-secondary">üìÖ Planning</a>
                <a href="dashboard.html" class="btn btn-secondary">üìä Dashboard</a>
            </nav>
        </div>
    </header>

    <main class="main suivi">
        <div class="page-header">
            <h1 class="page-title">Suivi des S√©ances</h1>
            <div class="quick-stats">
                <div class="stat-item">
                    <span class="stat-label">√Ä confirmer:</span>
                    <span id="pendingCount" class="stat-value">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Revenus du jour:</span>
                    <span id="dailyRevenue" class="stat-value">- DT</span>
                </div>
            </div>
        </div>

        <div class="suivi-layout">
            <!-- Left Column - Sessions to Confirm -->
            <div class="sessions-column">
                <div class="section-header">
                    <h2>S√©ances √† Confirmer</h2>
                    <div class="filters">
                        <select id="dateFilter" class="filter-select">
                            <option value="today">Aujourd'hui</option>
                            <option value="yesterday">Hier</option>
                            <option value="week">Cette semaine</option>
                            <option value="all">Toutes</option>
                        </select>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">Toutes cat√©gories</option>
                            <option value="tabac">Arr√™t du tabac</option>
                            <option value="drogue">Sevrage drogue</option>
                            <option value="drogue_dure">Sevrage drogues dures</option>
                            <option value="drogue_douce">Sevrage drogues douces</option>
                            <option value="renforcement">Renforcement</option>
                        </select>
                        <button id="refreshBtn" class="btn btn-secondary">üîÑ</button>
                    </div>
                </div>

                <div id="sessionsList" class="sessions-list">
                    <div class="loading">Chargement des s√©ances...</div>
                </div>
            </div>

            <!-- Right Column - Financial Summary -->
            <div class="summary-column">
                <!-- Today's Summary -->
                <div class="summary-card">
                    <h3>Aujourd'hui</h3>
                    <div class="summary-stats">
                        <div class="summary-row">
                            <span>Confirm√©es:</span>
                            <span id="todayConfirmed">- s√©ances ‚Ä¢ - DT</span>
                        </div>
                        <div class="summary-row">
                            <span>En attente:</span>
                            <span id="todayPending">- s√©ances ‚Ä¢ - DT estim√©</span>
                        </div>
                        <div class="summary-row">
                            <span>Absents:</span>
                            <span id="todayAbsent">- s√©ances ‚Ä¢ - DT</span>
                        </div>
                    </div>
                </div>

                <!-- Weekly Chart -->
                <div class="summary-card">
                    <h3>Cette Semaine</h3>
                    <div class="chart-container">
                        <canvas id="weeklyChart" width="300" height="150"></canvas>
                    </div>
                    <div class="summary-stats">
                        <div class="summary-row">
                            <span>Total:</span>
                            <span id="weeklyTotal">- DT</span>
                        </div>
                        <div class="summary-row">
                            <span>Moyenne/s√©ance:</span>
                            <span id="weeklyAverage">- DT</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="summary-card">
                    <h3>Actions Rapides</h3>
                    <div class="quick-actions">
                        <button id="markAllConfirmedBtn" class="btn btn-primary">
                            ‚úÖ Marquer tout confirm√©
                        </button>
                        <button id="dailyReportBtn" class="btn btn-secondary">
                            üìä Rapport journalier
                        </button>
                        <button id="exportFinancesBtn" class="btn btn-secondary">
                            üíæ Exporter finances
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Session Confirmation Modal -->
    <dialog id="sessionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="sessionModalTitle">Confirmer la S√©ance</h2>
                <button id="closeSessionModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <form id="sessionForm" class="modal-form">
                <div class="session-info-display">
                    <div id="sessionClientInfo" class="client-info"></div>
                </div>

                <div class="form-group">
                    <label>Statut de pr√©sence *</label>
                    <div class="attendance-options">
                        <label class="attendance-option">
                            <input type="radio" name="attendanceStatus" value="present" required>
                            <span class="option-content">
                                <span class="option-icon">‚úÖ</span>
                                <span class="option-text">Pr√©sent</span>
                                <small>Client pr√©sent, s√©ance effectu√©e</small>
                            </span>
                        </label>
                        <label class="attendance-option">
                            <input type="radio" name="attendanceStatus" value="absent" required>
                            <span class="option-content">
                                <span class="option-icon">‚ùå</span>
                                <span class="option-text">Absent</span>
                                <small>Client absent, s√©ance annul√©e</small>
                            </span>
                        </label>
                        <label class="attendance-option">
                            <input type="radio" name="attendanceStatus" value="rescheduled" required>
                            <span class="option-content">
                                <span class="option-icon">‚è∞</span>
                                <span class="option-text">Report√©</span>
                                <small>S√©ance report√©e √† une autre date</small>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="actualPrice">Prix de la s√©ance *</label>
                    <div class="price-options">
                        <button type="button" id="standardPriceBtn" class="price-btn active">
                            Prix standard (<span id="standardPriceValue">500</span> DT)
                        </button>
                        <button type="button" id="freePriceBtn" class="price-btn">
                            S√©ance offerte (0 DT)
                        </button>
                        <button type="button" id="customPriceBtn" class="price-btn">
                            Prix personnalis√©
                        </button>
                    </div>
                    <div class="price-input-group">
                        <input type="number" id="actualPrice" name="actualPrice" min="0" step="0.01" required>
                        <span class="currency">DT</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="priceNotes">Notes sur le prix (optionnel)</label>
                    <input type="text" id="priceNotes" name="priceNotes" placeholder="Remise, promotion, etc.">
                </div>

                <div class="form-group">
                    <label for="followUpNotes">Notes de suivi (optionnel)</label>
                    <textarea id="followUpNotes" name="followUpNotes" rows="3" placeholder="Observations, prochaines √©tapes, etc."></textarea>
                </div>

                <input type="hidden" id="sessionId" name="sessionId">

                <div class="modal-actions">
                    <button type="button" id="cancelSession" class="btn btn-secondary">Annuler</button>
                    <button type="submit" id="confirmSession" class="btn btn-primary">Confirmer</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Batch Confirmation Modal -->
    <dialog id="batchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmation en Lot</h2>
                <button id="closeBatchModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <div class="modal-form">
                <p>Marquer toutes les s√©ances d'aujourd'hui comme confirm√©es avec le prix standard ?</p>
                <div class="batch-preview" id="batchPreview">
                    <!-- Will be populated with session list -->
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancelBatch" class="btn btn-secondary">Annuler</button>
                    <button type="button" id="confirmBatch" class="btn btn-primary">Confirmer Tout</button>
                </div>
            </div>
        </div>
    </dialog>

    <footer class="footer">
        <p>¬© 2024 LaserOstop Tunisie</p>
    </footer>

    <script src="vendor/supabase.min.js?v=11"></script>
    <script src="suivi.js?v=11"></script>
</body>
</html>