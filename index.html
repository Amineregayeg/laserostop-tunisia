<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning LaserOstop Tunisie</title>
    <link rel="stylesheet" href="styles.css?v=10">
    <link rel="manifest" href="pwa/manifest.webmanifest">
    <meta name="theme-color" content="#0C9AA6">
    <meta name="description" content="Planning des rendez-vous LaserOstop Tunisie">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="assets/logo.webp" alt="LaserOstop Tunisie" class="logo-img">
                <select id="centerSelect" class="center-select">
                    <option value="tunis">Tunis</option>
                    <option value="sfax">Sfax</option>
                </select>
            </div>
            <nav class="nav-controls">
                <button id="installAppBtn" class="btn btn-primary install-btn" style="display: none;">
                    üì± Installer l'app
                </button>
                <button id="prevWeek" class="btn btn-secondary" aria-label="Semaine pr√©c√©dente">
                    ‚Üê Pr√©c√©dente
                </button>
                <button id="currentWeek" class="btn btn-secondary">
                    Aujourd'hui
                </button>
                <button id="nextWeek" class="btn btn-secondary" aria-label="Semaine suivante">
                    Suivante ‚Üí
                </button>
            </nav>
        </div>
    </header>

    <main class="main">
        <h1 id="weekTitle" class="week-title">Planning LaserOstop ‚Äî Semaine du</h1>
        
        <div class="calendar-container">
            <div id="calendar" class="calendar" role="grid" aria-label="Planning des rendez-vous"></div>
        </div>
    </main>

    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Modal Nouveau rendez-vous -->
    <dialog id="bookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nouveau rendez-vous</h2>
                <button id="closeModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <form id="bookingForm" class="modal-form">
                <div class="form-group">
                    <label for="clientName">Nom & Pr√©nom *</label>
                    <input type="text" id="clientName" name="clientName" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">T√©l√©phone *</label>
                    <input type="text" id="phone" name="phone" required>
                </div>

                <!-- Duration and Type Switches -->
                <div class="form-group">
                    <label>Dur√©e et Type de s√©ance</label>
                    <div class="switches-container">
                        <div class="switch-group">
                            <label class="switch-label">Dur√©e:</label>
                            <div class="duration-switch">
                                <button type="button" class="duration-btn active" data-duration="60">60 min</button>
                                <button type="button" class="duration-btn" data-duration="30">30 min</button>
                                <button type="button" class="duration-btn" data-duration="90">90 min</button>
                            </div>
                        </div>
                        <div class="switch-group">
                            <label class="switch-label">Type:</label>
                            <div class="type-switch">
                                <button type="button" class="type-btn active" data-type="solo">Solo</button>
                                <button type="button" class="type-btn" data-type="duo">Duo</button>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="sessionDuration" name="sessionDuration" value="60">
                    <input type="hidden" id="sessionType" name="sessionType" value="solo">
                </div>
                
                <div class="form-group">
                    <fieldset>
                        <legend>Cat√©gorie *</legend>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="category" value="tabac" required>
                                <span>Arr√™t du tabac</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="category" value="drogue" required>
                                <span>Sevrage drogue</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="category" value="drogue_dure" required>
                                <span>Sevrage drogues dures</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="category" value="drogue_douce" required>
                                <span>Sevrage drogues douces</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="category" value="renforcement" required>
                                <span>Renforcement (gratuit, 30 min)</span>
                            </label>
                        </div>
                    </fieldset>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes (optionnel)</label>
                    <textarea id="notes" name="notes" maxlength="140" rows="3"></textarea>
                    <small class="char-count">0/140</small>
                </div>
                
                <div id="slotInfo" class="slot-info"></div>
                
                <div class="modal-actions">
                    <button type="button" id="cancelBooking" class="btn btn-secondary">Annuler</button>
                    <button type="submit" id="submitBooking" class="btn btn-primary">R√©server</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Modal D√©tails rendez-vous -->
    <dialog id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>D√©tails du rendez-vous</h2>
                <button id="closeDetailsModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <div id="bookingDetails" class="booking-details"></div>
            <div class="modal-actions">
                <button type="button" id="editBookingBtn" class="btn btn-primary">Modifier</button>
                <button type="button" id="cancelBookingBtn" class="btn btn-danger">Annuler le RDV</button>
                <button type="button" id="closeDetails" class="btn btn-secondary">Fermer</button>
            </div>
        </div>
    </dialog>

    <!-- Modal Confirmation -->
    <dialog id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmation</h2>
            </div>
            <p id="confirmMessage"></p>
            <div class="modal-actions">
                <button type="button" id="confirmNo" class="btn btn-secondary">Non</button>
                <button type="button" id="confirmYes" class="btn btn-danger">Oui</button>
            </div>
        </div>
    </dialog>

    <!-- Modal Edit Booking -->
    <dialog id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier le rendez-vous</h2>
                <button id="closeEditModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <form id="editForm" class="modal-form">
                <div class="form-group">
                    <label for="editClientName">Nom & Pr√©nom *</label>
                    <input type="text" id="editClientName" name="editClientName" required>
                </div>

                <div class="form-group">
                    <label for="editPhone">T√©l√©phone *</label>
                    <input type="text" id="editPhone" name="editPhone" required>
                </div>

                <div class="form-group">
                    <label>Dur√©e et Type de s√©ance</label>
                    <div class="switches-container">
                        <div class="switch-group">
                            <label class="switch-label">Dur√©e:</label>
                            <div class="duration-switch">
                                <button type="button" class="edit-duration-btn" data-duration="60">60 min</button>
                                <button type="button" class="edit-duration-btn" data-duration="30">30 min</button>
                                <button type="button" class="edit-duration-btn" data-duration="90">90 min</button>
                            </div>
                        </div>
                        <div class="switch-group">
                            <label class="switch-label">Type:</label>
                            <div class="type-switch">
                                <button type="button" class="edit-type-btn" data-type="solo">Solo</button>
                                <button type="button" class="edit-type-btn" data-type="duo">Duo</button>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="editSessionDuration" name="editSessionDuration">
                    <input type="hidden" id="editSessionType" name="editSessionType">
                </div>

                <div class="form-group">
                    <fieldset>
                        <legend>Cat√©gorie *</legend>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="editCategory" value="tabac" required>
                                <span>Arr√™t du tabac</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="editCategory" value="drogue" required>
                                <span>Sevrage drogue</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="editCategory" value="drogue_dure" required>
                                <span>Sevrage drogues dures</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="editCategory" value="drogue_douce" required>
                                <span>Sevrage drogues douces</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="editCategory" value="renforcement" required>
                                <span>Renforcement (gratuit, 30 min)</span>
                            </label>
                        </div>
                    </fieldset>
                </div>

                <div class="form-group">
                    <label for="editNotes">Notes (optionnel)</label>
                    <textarea id="editNotes" name="editNotes" maxlength="140" rows="3"></textarea>
                    <small class="edit-char-count">0/140</small>
                </div>

                <input type="hidden" id="editBookingId" name="editBookingId">

                <div class="modal-actions">
                    <button type="button" id="cancelEdit" class="btn btn-secondary">Annuler</button>
                    <button type="submit" id="submitEdit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Modal Duplicate Client -->
    <dialog id="duplicateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Client d√©j√† enregistr√©</h2>
                <button id="closeDuplicateModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <div class="duplicate-info">
                <p id="duplicateDescription"></p>
                <div class="duplicate-preview">
                    <div class="existing-booking-preview" id="existingBookingInfo"></div>
                </div>
            </div>
            <div class="duplicate-options">
                <h3>Comment voulez-vous proc√©der ?</h3>
                <div class="option-buttons">
                    <button type="button" id="moveOldBtn" class="btn btn-primary duplicate-option">
                        üîÑ D√©placer l'ancien
                        <small>D√©placer le rendez-vous existant au nouveau cr√©neau</small>
                    </button>
                    <button type="button" id="keepBothBtn" class="btn btn-secondary duplicate-option">
                        üìÖ Garder les deux
                        <small>Cr√©er un deuxi√®me rendez-vous pour ce client</small>
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" id="cancelDuplicateBtn" class="btn btn-secondary">Annuler</button>
            </div>
        </div>
    </dialog>

    <!-- Modal Conflict Resolution -->
    <dialog id="conflictModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Conflit de cr√©neaux</h2>
                <button id="closeConflictModal" class="btn-close" aria-label="Fermer">√ó</button>
            </div>
            <div class="conflict-info">
                <p id="conflictDescription"></p>
                <div class="conflict-preview">
                    <div class="session-preview" id="movingSession"></div>
                    <div class="conflict-arrow">‚Üì</div>
                    <div class="session-preview" id="conflictingSession"></div>
                </div>
            </div>
            <div class="conflict-options">
                <h3>Comment r√©soudre ce conflit ?</h3>
                <div class="option-buttons">
                    <button type="button" id="shareTimeBtn" class="btn btn-primary conflict-option">
                        üìÖ Partager le temps
                        <small>Les deux s√©ances se chevauchent</small>
                    </button>
                    <button type="button" id="moveDownBtn" class="btn btn-secondary conflict-option">
                        ‚¨áÔ∏è D√©caler vers le bas
                        <small>D√©placer les autres s√©ances automatiquement</small>
                    </button>
                    <button type="button" id="replaceBtn" class="btn btn-danger conflict-option">
                        üîÑ Remplacer
                        <small>Annuler l'autre s√©ance</small>
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" id="cancelMoveBtn" class="btn btn-secondary">Annuler le d√©placement</button>
            </div>
        </div>
    </dialog>

    <footer class="footer">
        <p>¬© 2024 LaserOstop Tunisie - <a href="dashboard.html">üìä Dashboard</a> ‚Ä¢ <a href="suivi.html">üìã Suivi</a></p>
    </footer>

    <script src="vendor/supabase.min.js?v=10"></script>
    <script src="app.js?v=10"></script>
</body>
</html>